#!/usr/bin/python3

from xml.etree.ElementTree import ElementTree
from thefoxUtils import unikey
import os.path
import argparse


def main():
    parser = argparse.ArgumentParser(description='Extract text from FTML files')
    parser.add_argument('file', help='FTML files to process', nargs='+')
    parser.add_argument('--version', action='version', version='%(prog)s ' + '0.1')
    args = parser.parse_args()

    for ftml_filename in args.file:
        extract_text(ftml_filename)


def extract_text(ftml_filename):

    # Construct output filename
    (text_filename, ext) = os.path.splitext(ftml_filename)
    text_filename = f'generated/{text_filename}-ftml.txt'

    # Read FTML file
    ftml = ElementTree()
    ftml.parse(ftml_filename)

    # Extract text from FTML file to text file
    with open(text_filename, 'w') as text_file:
        for testgroup in ftml.iter('testgroup'):
            text_file.write('\# ' + testgroup.get('label') + '\n')
            for test in testgroup.iter('test'):
                text_file.write(test.get('label') + ' ')
                for literal_string in test.iter('string'):
                    actual_string = unikey.modify(literal_string.text)
                    text_file.write(actual_string + '\n')


if __name__ == "__main__":
    main()
